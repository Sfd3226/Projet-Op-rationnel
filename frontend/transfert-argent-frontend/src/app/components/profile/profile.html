<canvas id="nebula-bg" class="nebula-canvas"></canvas>

<div class="dashboard-container">
  <div class="dashboard-header">
    <div class="user-info">
      <div class="user-avatar">
        <img [src]="getPhotoProfilUrl()" alt="Photo de profil" class="avatar-image" />
        <div class="avatar-overlay" (click)="toggleEdit()">
          <i class="edit-icon">‚úèÔ∏è</i>
        </div>
      </div>
      <div class="user-details">
        <h1>Bonjour, {{ profile?.prenom }} {{ profile?.nom }} üëã</h1>
        <p>G√©rez votre profil et vos comptes</p>
      </div>
    </div>
    <button class="logout-btn" (click)="logout()">üö™ D√©connexion</button>
  </div>

  <div class="alert alert-error" *ngIf="errorMessage">
    {{ errorMessage }}
    <button class="alert-close" (click)="errorMessage = ''">√ó</button>
  </div>
  <div class="alert alert-success" *ngIf="successMessage">
    {{ successMessage }}
    <button class="alert-close" (click)="successMessage = ''">√ó</button>
  </div>

  <div class="loading" *ngIf="loading">
    <div class="loading-spinner"></div>
    <p>Chargement de vos donn√©es...</p>
  </div>

  <div class="profile-content" *ngIf="profile && !loading">
    <div class="card form-card" *ngIf="isEditing">
      <div class="card-glow"></div>
      <h3>‚úèÔ∏è Modifier le profil</h3>
      
      <form [formGroup]="profileForm" (ngSubmit)="updateProfile()">
        <div class="form-grid">
          <div class="form-group">
            <label>Pr√©nom</label>
            <input type="text" formControlName="prenom" placeholder="Votre pr√©nom" />
            <div class="error" *ngIf="profileForm.get('prenom')?.invalid && profileForm.get('prenom')?.touched">
              Pr√©nom requis (min. 2 caract√®res)
            </div>
          </div>
          <div class="form-group">
            <label>Nom</label>
            <input type="text" formControlName="nom" placeholder="Votre nom" />
            <div class="error" *ngIf="profileForm.get('nom')?.invalid && profileForm.get('nom')?.touched">
              Nom requis (min. 2 caract√®res)
            </div>
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email" placeholder="votre@email.com" />
            <div class="error" *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
              Email invalide
            </div>
          </div>
          <div class="form-group">
            <label>T√©l√©phone</label>
            <input type="tel" formControlName="telephone" placeholder="+221 XX XXX XX XX" />
            <div class="error" *ngIf="profileForm.get('telephone')?.invalid && profileForm.get('telephone')?.touched">
              Num√©ro de t√©l√©phone invalide
            </div>
          </div>
          <div class="form-group">
            <label>Pays</label>
            <input type="text" formControlName="pays" placeholder="Votre pays" />
            <div class="error" *ngIf="profileForm.get('pays')?.invalid && profileForm.get('pays')?.touched">
              Pays requis
            </div>
          </div>
          <div class="form-group">
            <label>Photo de profil (URL)</label>
            <input type="url" formControlName="photoProfil" placeholder="https://..." />
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="toggleEdit()">Annuler</button>
          <button type="submit" class="btn btn-primary" [disabled]="!profileForm.valid">Enregistrer</button>
        </div>
      </form>
    </div>

    <div class="card info-card" *ngIf="!isEditing">
      <div class="card-glow"></div>
      <h3>üë§ Informations personnelles</h3>
      <div class="info-grid">
        <div class="info-item">
          <span class="info-label">Pr√©nom</span>
          <span class="info-value">{{ profile.prenom }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Nom</span>
          <span class="info-value">{{ profile.nom }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Email</span>
          <span class="info-value">{{ profile.email }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">T√©l√©phone</span>
          <span class="info-value">{{ profile.telephone }}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Pays</span>
          <span class="info-value">{{ profile.pays }}</span>
        </div>
      </div>
      <div class="card-actions">
        <button class="btn btn-primary" (click)="toggleEdit()">‚úèÔ∏è Modifier le profil</button>
        <button class="btn btn-outline" (click)="togglePasswordChange()">üîí Changer le mot de passe</button>
      </div>
    </div>

    <div class="card password-card" *ngIf="isChangingPassword">
      <div class="card-glow"></div>
      <h3>üîí Changer le mot de passe</h3>
      <form [formGroup]="passwordForm" (ngSubmit)="changePassword()">
        <div class="form-group">
          <label>Mot de passe actuel</label>
          <input type="password" formControlName="currentPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
        </div>
        <div class="form-group">
          <label>Nouveau mot de passe</label>
          <input type="password" formControlName="newPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          <div class="error" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
            Min. 6 caract√®res
          </div>
        </div>
        <div class="form-group">
          <label>Confirmer le mot de passe</label>
          <input type="password" formControlName="confirmPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          <div class="error" *ngIf="passwordForm.hasError('mismatch')">
            Les mots de passe ne correspondent pas
          </div>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" (click)="togglePasswordChange()">Annuler</button>
          <button type="submit" class="btn btn-primary" [disabled]="!passwordForm.valid">Changer le mot de passe</button>
        </div>
      </form>
    </div>
  </div>
</div>