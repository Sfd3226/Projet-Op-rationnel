<canvas id="nebula-bg" class="nebula-canvas"></canvas>

<div class="center-wrap">
  <div class="card register-card">
    <div class="card-glow"></div>
    <header class="card-head">
      <h1 class="title">Créer un compte</h1>
      <p class="subtitle">Inscris-toi et accède à ton espace — rapide et sécurisé</p>
    </header>
    
    <div class="alert alert-error" *ngIf="message">{{ message }}</div>

    <form [formGroup]="registerForm" (ngSubmit)="submit()" class="form">
      <div class="form-grid">
        <label class="field">
          <span class="label-text">Nom</span>
          <input type="text" formControlName="nom" placeholder="Nom" />
          <small class="error" *ngIf="nom?.invalid && (nom?.touched || nom?.dirty)">
            <span *ngIf="nom?.errors?.['required']">Nom requis</span>
          </small>
        </label>

        <label class="field">
          <span class="label-text">Prénom</span>
          <input type="text" formControlName="prenom" placeholder="Prénom" />
          <small class="error" *ngIf="prenom?.invalid && (prenom?.touched || prenom?.dirty)">
            <span *ngIf="prenom?.errors?.['required']">Prénom requis</span>
          </small>
        </label>
      </div>

      <label class="field">
        <span class="label-text">Email</span>
        <input type="email" formControlName="email" placeholder="email@example.com" />
        <small class="error" *ngIf="email?.invalid && (email?.touched || email?.dirty)">
          <span *ngIf="email?.errors?.['required']">Email requis</span>
          <span *ngIf="email?.errors?.['email']">Email invalide</span>
        </small>
      </label>

      <label class="field">
        <span class="label-text">Téléphone</span>
        <input type="text" formControlName="telephone" placeholder="778889999" />
        <small class="error" *ngIf="telephone?.invalid && (telephone?.touched || telephone?.dirty)">
          <span *ngIf="telephone?.errors?.['required']">Téléphone requis</span>
          <span *ngIf="telephone?.errors?.['pattern']">Format invalide</span>
        </small>
      </label>
      
      <label class="field">
        <span class="label-text">Pays</span>
        <input type="text" formControlName="pays" placeholder="Sénégal" />
        <small class="error" *ngIf="pays?.invalid && (pays?.touched || pays?.dirty)">
          <span *ngIf="pays?.errors?.['required']">Pays requis</span>
        </small>
      </label>

      <label class="field">
        <span class="label-text">Mot de passe</span>
        <input type="password" formControlName="password" placeholder="••••••••" />
        <small class="error" *ngIf="password?.invalid && (password?.touched || password?.dirty)">
          <span *ngIf="password?.errors?.['required']">Mot de passe requis</span>
          <span *ngIf="password?.errors?.['minlength']">6 caractères minimum</span>
        </small>
      </label>

      <label class="field">
        <span class="label-text">Confirmer mot de passe</span>
        <input type="password" formControlName="confirmPassword" placeholder="••••••••" />
        <small class="error" *ngIf="registerForm?.errors?.['mismatch'] && (confirmPassword?.touched || confirmPassword?.dirty)">
          Les mots de passe ne correspondent pas
        </small>
      </label>

      <label class="field">
        <span class="label-text">Numéro de pièce</span>
        <input type="text" formControlName="numeroPiece" placeholder="CNI12345678" />
        <small class="error" *ngIf="numeroPiece?.invalid && (numeroPiece?.touched || numeroPiece?.dirty)">
          <span *ngIf="numeroPiece?.errors?.['required']">Numéro de pièce requis</span>
        </small>
      </label>

      <div class="form-grid file-inputs">
        <label class="field">
          <span class="label-text">Photo de profil</span>
          <input type="file" (change)="onPhotoProfilChange($event)" accept="image/*" />
        </label>
        
        <label class="field">
          <span class="label-text">Photo de la pièce d'identité</span>
          <input type="file" (change)="onCniChange($event)" accept="image/*" />
        </label>
      </div>

      <div class="actions">
        <button class="btn btn-primary" type="submit" [disabled]="loading">
          <span *ngIf="!loading">S'inscrire</span>
          <span *ngIf="loading">Enregistrement…</span>
        </button>
      </div>
    </form>

    <footer class="card-foot">
      <a [routerLink]="['/login']" class="link">Déjà un compte ? Se connecter</a>
    </footer>
  </div>
</div>